diff --git a/src/gdb_main.c b/src/gdb_main.c
index f022fe48..57c35135 100644
--- a/src/gdb_main.c
+++ b/src/gdb_main.c
@@ -404,6 +404,9 @@ static void exec_q_supported(const char *packet, const size_t length)
 	gdb_putpacket_f("PacketSize=%X;qXfer:memory-map:read+;qXfer:features:read+", GDB_MAX_PACKET_SIZE);
 }
 
+extern  char *ztarget_mem_map(const target_s *t);
+
+
 static void exec_q_memory_map(const char *packet, const size_t length)
 {
 	(void)packet;
@@ -417,9 +420,15 @@ static void exec_q_memory_map(const char *packet, const size_t length)
 		gdb_putpacketz("E01");
 		return;
 	}
+#if 0    
 	char buf[1024];
 	target_mem_map(cur_target, buf, sizeof(buf)); /* Fixme: Check size!*/
 	handle_q_string_reply(buf, packet);
+#else
+    char *out=ztarget_mem_map(cur_target);
+    handle_q_string_reply(out,packet);
+    free(out);
+#endif
 }
 
 static void exec_q_feature_read(const char *packet, const size_t length)
